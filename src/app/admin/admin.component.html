<div class="admin-dashboard">
  <header class="admin-header">
    <h1>Admin Dashboard</h1>
    <div class="admin-controls">
      <button (click)="refreshAllData()" class="btn-refresh">Refresh Data</button>
    </div>
  </header>

  <nav class="admin-nav">
    <button 
      *ngFor="let tab of tabs" 
      (click)="activeTab = tab.id"
      [class.active]="activeTab === tab.id"
      class="nav-btn">
      {{ tab.name }}
    </button>
  </nav>

  <div class="admin-content">
    <!-- Users Management -->
    <div *ngIf="activeTab === 'users'" class="tab-content">
      <h2>User Management</h2>
      <div class="search-controls">
        <input type="text" placeholder="Search users..." [(ngModel)]="userSearchTerm" (input)="searchUsers()">
        <button (click)="loadUsers()" class="btn-action">Load All Users</button>
      </div>
      
      <div class="table-container">
        <table>
          <thead>
            <tr>
              <th>ID</th>
              <th>Username</th>
              <th>Email</th>
              <th>Role</th>
              <th>Status</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let user of filteredUsers">
              <td>{{ user.id }}</td>
              <td>{{ user.userName }}</td>
              <td>{{ user.email }}</td>
              <td>{{ user.role }}</td>
              <td>{{ user.isActive ? 'Active' : 'Inactive' }}</td>
              <td class="action-buttons">
                <button (click)="editUser(user)" class="btn-edit">Edit</button>
                <button (click)="deleteUser(user.id)" class="btn-delete">Delete</button>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <!-- Products Management -->
    <div *ngIf="activeTab === 'products'" class="tab-content">
      <h2>Product Management</h2>
      <div class="action-bar">
        <button (click)="showAddProduct()" class="btn-add">Add New Product</button>
      </div>
      
      <div class="table-container">
        <table>
          <thead>
            <tr>
              <th>ID</th>
              <th>Name</th>
              <th>Price</th>
              <th>Stock</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let product of products">
              <td>{{ product.id }}</td>
              <td>{{ product.name }}</td>
              <td>{{ product.price | currency }}</td>
              <td>{{ product.stock }}</td>
              <td class="action-buttons">
                <button (click)="editProduct(product)" class="btn-edit">Edit</button>
                <button (click)="deleteProduct(product.id)" class="btn-delete">Delete</button>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <!-- Orders Management -->
   <div *ngIf="activeTab === 'orders'" class="tab-content">
  <h2>Order Management</h2>
  <div class="filter-controls">
    <select [(ngModel)]="orderStatusFilter" (change)="filterOrders()">
      <option value="all">All Orders</option>
      <option [value]="0">Pending</option>
      <option [value]="1">Paid</option>
      <option [value]="2">Shipped</option>
      <option [value]="3">Delivered</option>
    </select>
  </div>
  
  <div class="table-container">
    <table>
      <thead>
        <tr>
          <th>Order ID</th>
          <th>Customer</th>
          <th>Date</th>
          <th>Status</th>
          <th>Total</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let order of filteredOrders">
          <td>{{ order.id }}</td>
          <td>{{ order.customerName }}</td>
          <td>{{ order.orderDate | date }}</td>
          <td>
            <!-- Fix the event handler here -->
            <select [ngModel]="order.status" (ngModelChange)="updateOrderStatus(order, $event)">
             <option [value]="0">Pending</option>
<option [value]="1">Paid</option>
<option [value]="2">Shipped</option>
<option [value]="3">Completed</option>
            </select>
            <span class="status-text">({{ getStatusText(order.status) }})</span>
          </td>
          <td>{{ order.totalAmount | currency }}</td>
          <td class="action-buttons">
            <button (click)="viewOrderDetails(order)" class="btn-view">View</button>
            <button (click)="deleteOrder(order.id)" class="btn-delete">Delete</button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>
</div>
    <!-- Messages Management -->
    <div *ngIf="activeTab === 'messages'" class="tab-content">
      <h2>Contact Messages</h2>
      <div class="message-controls">
        <button (click)="loadUnreadMessages()" class="btn-action">Show Unread ({{ unreadMessageCount }})</button>
        <button (click)="markAllAsRead()" class="btn-action">Mark All as Read</button>
      </div>
      
      <div class="table-container">
        <table>
          <thead>
            <tr>
              <th>From</th>
              <th>Email</th>
              <th>Subject</th>
              <th>Date</th>
              <th>Status</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let message of messages" [class.unread]="!message.read">
              <td>{{ message.name }}</td>
              <td>{{ message.email }}</td>
              <td>{{ message.subject }}</td>
              <td>{{ message.date | date }}</td>
              <td>{{ message.read ? 'Read' : 'Unread' }}</td>
              <td class="action-buttons">
                <button (click)="viewMessage(message)" class="btn-view">View</button>
                <button (click)="deleteMessage(message.id)" class="btn-delete">Delete</button>
                <button *ngIf="!message.read" (click)="markAsRead(message.id)" class="btn-action">Mark Read</button>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <!-- Reviews Management -->
    <div *ngIf="activeTab === 'reviews'" class="tab-content">
      <h2>Product Reviews</h2>
      <div class="filter-controls">
        <button (click)="loadPendingReviews()" class="btn-action">Show Pending Reviews</button>
        <button (click)="loadReviews()" class="btn-action">Show All Reviews</button>
      </div>
      
      <div class="table-container">
        <table>
          <thead>
            <tr>
              <th>Product</th>
              <th>User</th>
              <th>Rating</th>
              <th>Date</th>
              <th>Status</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let review of reviews">
              <td>{{ review.productName }}</td>
              <td>{{ review.userName }}</td>
              <td>{{ review.rating }}/5</td>
              <td>{{ review.date | date }}</td>
              <td>{{ review.approved ? 'Approved' : 'Pending' }}</td>
              <td class="action-buttons">
                <button (click)="viewReview(review)" class="btn-view">View</button>
                <button (click)="approveReview(review.id)" class="btn-edit" *ngIf="!review.approved">Approve</button>
                <button (click)="deleteReview(review.id)" class="btn-delete">Delete</button>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- Edit User Modal -->
  <div *ngIf="editingUser" class="modal-backdrop">
    <div class="modal">
      <h3>Edit User</h3>
      <div class="modal-content">
        <div class="form-group">
          <label>Username</label>
          <input type="text" [(ngModel)]="editingUser.userName" class="form-input">
        </div>
        <div class="form-group">
          <label>Email</label>
          <input type="email" [(ngModel)]="editingUser.email" class="form-input">
        </div>
        <div class="form-group">
          <label>Role</label>
          <input type="text" [(ngModel)]="editingUser.role" class="form-input">
        </div>
        <div class="form-group">
          <label>Status</label>
          <select [(ngModel)]="editingUser.isActive" class="form-input">
            <option [value]="true">Active</option>
            <option [value]="false">Inactive</option>
          </select>
        </div>
      </div>
      <div class="modal-actions">
        <button (click)="cancelEditUser()" class="btn-cancel">Cancel</button>
        <button (click)="saveUser()" class="btn-save">Save Changes</button>
      </div>
    </div>
  </div>

  <!-- Add/Edit Product Modal -->
  <div *ngIf="showAddProductForm" class="modal-backdrop">
    <div class="modal">
      <h3>{{ editingProduct ? 'Edit Product' : 'Add New Product' }}</h3>
      <form [formGroup]="productForm" class="modal-content">
        <div class="form-group">
          <label>Product Name</label>
          <input type="text" formControlName="name" class="form-input" required>
        </div>
        <div class="form-group">
          <label>Price</label>
          <input type="number" formControlName="price" class="form-input" min="0" step="0.01" required>
        </div>
        <div class="form-group">
          <label>Stock</label>
          <input type="number" formControlName="stock" class="form-input" min="0" required>
        </div>
        <div class="form-group">
          <label>Description</label>
          <textarea formControlName="description" class="form-input"></textarea>
        </div>
        <div class="form-group">
          <label>Category</label>
          <input type="text" formControlName="category" class="form-input">
        </div>
        <div class="form-group">
          <label>Image URL</label>
          <input type="url" formControlName="imageUrl" class="form-input">
        </div>
      </form>
      <div class="modal-actions">
        <button (click)="cancelProductEdit()" class="btn-cancel">Cancel</button>
        <button (click)="saveProduct()" class="btn-save" [disabled]="!productForm.valid">
          {{ editingProduct ? 'Update' : 'Create' }} Product
        </button>
      </div>
    </div>
  </div>

  <!-- Order Details Modal -->
  <div *ngIf="selectedOrder" class="modal-backdrop">
    <div class="modal large-modal">
      <h3>Order Details - #{{ selectedOrder.id }}</h3>
      <div class="modal-content">
        <div class="order-detail-section">
          <h4>Customer Information</h4>
          <p><strong>Name:</strong> {{ selectedOrder.customerName }}</p>
          <p><strong>Order Date:</strong> {{ selectedOrder.orderDate | date:'medium' }}</p>
          <p><strong>Status:</strong> {{ selectedOrder.status }}</p>
          <p><strong>Total Amount:</strong> {{ selectedOrder.totalAmount | currency }}</p>
        </div>
        
        <div class="order-detail-section">
          <h4>Order Items</h4>
          <table class="items-table">
            <thead>
              <tr>
                <th>Product</th>
                <th>Quantity</th>
                <th>Price</th>
                <th>Total</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let item of selectedOrder.items">
                <td>{{ item.productName }}</td>
                <td>{{ item.quantity }}</td>
                <td>{{ item.price | currency }}</td>
                <td>{{ item.price * item.quantity | currency }}</td>
              </tr>
            </tbody>
          </table>
        </div>
        
        <div class="order-detail-section" *ngIf="selectedOrder.shippingAddress">
          <h4>Shipping Address</h4>
          <p>{{ selectedOrder.shippingAddress }}</p>
        </div>
      </div>
      <div class="modal-actions">
        <button (click)="closeOrderDetails()" class="btn-cancel">Close</button>
      </div>
    </div>
  </div>

  <!-- Message Details Modal -->
  <div *ngIf="selectedMessage" class="modal-backdrop">
    <div class="modal">
      <h3>Message from {{ selectedMessage.name }}</h3>
      <div class="modal-content">
        <div class="message-detail-section">
          <p><strong>Email:</strong> {{ selectedMessage.email }}</p>
          <p><strong>Subject:</strong> {{ selectedMessage.subject }}</p>
          <p><strong>Date:</strong> {{ selectedMessage.date | date:'medium' }}</p>
          <p><strong>Status:</strong> {{ selectedMessage.read ? 'Read' : 'Unread' }}</p>
        </div>
        
        <div class="message-detail-section">
          <h4>Message Content</h4>
          <div class="message-content">
            {{ selectedMessage.message }}
          </div>
        </div>
      </div>
      <div class="modal-actions">
        <button (click)="closeMessage()" class="btn-cancel">Close</button>
        <button (click)="deleteMessage(selectedMessage.id)" class="btn-delete">Delete Message</button>
      </div>
    </div>
  </div>

  <!-- Review Details Modal -->
  <div *ngIf="selectedReview" class="modal-backdrop">
    <div class="modal">
      <h3>Review for {{ selectedReview.productName }}</h3>
      <div class="modal-content">
        <div class="review-detail-section">
          <p><strong>User:</strong> {{ selectedReview.userName }}</p>
          <p><strong>Rating:</strong> {{ selectedReview.rating }}/5</p>
          <p><strong>Date:</strong> {{ selectedReview.date | date:'medium' }}</p>
          <p><strong>Status:</strong> {{ selectedReview.approved ? 'Approved' : 'Pending' }}</p>
        </div>
        
        <div class="review-detail-section">
          <h4>Review Comment</h4>
          <div class="review-content">
            {{ selectedReview.comment }}
          </div>
        </div>
      </div>
      <div class="modal-actions">
        <button (click)="closeReview()" class="btn-cancel">Close</button>
        <button (click)="approveReview(selectedReview.id)" class="btn-edit" *ngIf="!selectedReview.approved">
          Approve Review
        </button>
        <button (click)="deleteReview(selectedReview.id)" class="btn-delete">Delete Review</button>
      </div>
    </div>
  </div>
</div>